{"version":3,"file":"index.js","sources":["../../../src/js/lib/EventTarget.js","../../../src/js/lib/DataChannel.js","../../../src/js/lib/thumbDataURI.js","../../../src/js/index.js"],"sourcesContent":["export default class EventTarget {\n  constructor() {\n    this.listeners = {};\n  }\n\n  addEventListener(type, callback) {\n    if (!(type in this.listeners)) {\n      this.listeners[type] = [];\n    }\n    this.listeners[type].push(callback);\n  }\n\n  removeEventListener(type, callback) {\n    if (!(type in this.listeners)) return;\n\n    const stack = this.listeners[type];\n    for (let i = 0, l = stack.length; i < l; i += 1) {\n      if (stack[i] === callback) {\n        stack.splice(i, 1);\n        return;\n      }\n    }\n  }\n\n  dispatchEvent(event) {\n    if (!(event.type in this.listeners)) return true;\n\n    const stack = this.listeners[event.type];\n    for (let i = 0, l = stack.length; i < l; i += 1) {\n      stack[i].call(this, event);\n    }\n    return !event.defaultPrevented;\n  }\n\n  on(type, callback) {\n    return this.addEventListener(type, callback);\n  }\n}\n","import EventTarget from './EventTarget';\n\nexport default class DataChannel extends EventTarget {\n  constructor() {\n    super();\n\n    this.peers = {};\n\n    this.newPeer = {\n      connection: null,\n      channel: null,\n      data: null,\n    };\n\n    this.RTCPeerConnectionOptions = { iceServers: [{ urls: ['stun:stun.l.google.com:19302'] }] };\n    this.RTCDataChannelOptions = { ordered: false, maxPacketLifeTime: 1000 };\n\n    this.signalingServer = io.connect('/');\n\n    this.bindClassMethods();\n    this.setEventListeners();\n  }\n\n  bindClassMethods() {\n    // eslint-disable-next-line no-restricted-syntax\n    for (const method in this) {\n      if (typeof this[method] === 'function') {\n        this[method] = this[method].bind(this);\n      }\n    }\n  }\n\n  setEventListeners() {\n    this.signalingServer.on('connect', this.onConnection);\n    this.signalingServer.on('peerIce', this.onPeerIce);\n    this.signalingServer.on('peerAnswer', this.onPeerAnswer);\n    this.signalingServer.on('peerOffer', this.onPeerOffer);\n    this.signalingServer.on('peerWantsACall', this.onPeerWantsACall);\n    this.signalingServer.on('peerUpdate', this.onPeerUpdate);\n    this.signalingServer.on('peerDisconnect', this.onPeerDisconnect);\n    this.signalingServer.on('signalingServerMessage', this.onSignalingServerMessage);\n  }\n\n  sendMessage(label, ...input) {\n    const data = input.length === 1 ? input[0] : input;\n    const peerKeys = Object.keys(this.peers);\n\n    peerKeys.forEach((peerId) => {\n      if (!this.peers[peerId].channel) return;\n      if (this.peers[peerId].channel.readyState !== 'open') return;\n\n      const message = JSON.stringify({ label, data });\n      this.peers[peerId].channel.send(message);\n    });\n  }\n\n  onConnection() {\n    console.log(this.signalingServer.id);\n  }\n\n  onPeerIce(peerId, RTCIceCandidate) {\n    if (!RTCIceCandidate.candidate) return;\n    if (!this.peers[peerId]) return;\n\n    this.peers[peerId].connection.addIceCandidate(RTCIceCandidate);\n  }\n\n  onPeerAnswer(peerId, RemoteRTCSessionDescription) {\n    if (!this.peers[peerId]) return;\n\n    this.peers[peerId].connection.setRemoteDescription(RemoteRTCSessionDescription);\n  }\n\n  onPeerOffer(peerId, RemoteRTCSessionDescription) {\n    // if there is no peer yet, create an empty one\n    if (!this.peers[peerId]) this.peers[peerId] = { ...this.newPeer };\n\n    // else if the peer did exists\n    // check if there is no connection yet\n    // the peer object might exists since we can get 'userUpdate' before 'peerOffer'\n    // if we find a connection, then the connection is already setup. so we won't need\n    // to create a new one\n    if (this.peers[peerId].connection) return;\n\n    const Peer = this.peers[peerId];\n\n    Peer.connection = new RTCPeerConnection(this.RTCPeerConnectionOptions, null);\n\n    Peer.connection\n      .setRemoteDescription(RemoteRTCSessionDescription)\n      .then(() => Peer.connection.createAnswer())\n      .then((LocalRTCSessionDescription) => {\n        Peer.connection.setLocalDescription(LocalRTCSessionDescription);\n        this.signalingServer.emit('peerAnswer', peerId, LocalRTCSessionDescription);\n      })\n      .catch(() => {\n        this.dispatchEvent(new CustomEvent('connectionError', {\n          detail: { message: 'Failed to connect to another users' },\n        }));\n      });\n\n    Peer.connection.addEventListener('icecandidate', (RTCPeerConnectionIceEvent) => {\n      if (!RTCPeerConnectionIceEvent.candidate) return;\n\n      this.signalingServer.emit('peerIce', peerId, RTCPeerConnectionIceEvent.candidate);\n    });\n\n    Peer.connection.addEventListener('datachannel', (RTCDataChannelEvent) => {\n      if (!RTCDataChannelEvent.channel) return;\n\n      Peer.channel = RTCDataChannelEvent.channel;\n\n      Peer.channel.addEventListener('open', () => {\n        this.dispatchEvent(new CustomEvent('dataChannelStateChange', {\n          detail: { state: 'open', connection: { peerId } },\n        }));\n\n        Peer.channel.addEventListener('message', this.onMessage);\n      });\n\n      Peer.channel.addEventListener('close', () => {\n        this.dispatchEvent(new CustomEvent('dataChannelStateChange', {\n          detail: { state: 'close', connection: { peerId } },\n        }));\n      });\n    });\n  }\n\n  onPeerWantsACall(peerId) {\n    if (this.peers[peerId]) return;\n\n    this.peers[peerId] = { ...this.newPeer };\n    const Peer = this.peers[peerId];\n\n    Peer.connection = new RTCPeerConnection(this.RTCPeerConnectionOptions, null);\n\n    Peer.channel = Peer.connection.createDataChannel('datachannel', this.RTCDataChannelOptions);\n\n    Peer.connection.addEventListener('datachannel', (event) => {\n      Peer.channel = event.channel;\n    });\n\n    Peer.connection.addEventListener('icecandidate', (RTCPeerConnectionIceEvent) => {\n      if (!RTCPeerConnectionIceEvent.candidate) return;\n\n      this.signalingServer.emit('peerIce', peerId, RTCPeerConnectionIceEvent.candidate);\n    });\n\n    Peer.connection.addEventListener('negotiationneeded', () => {\n      Peer.connection\n        .createOffer()\n        .then((LocalRTCSessionDescription) => {\n          Peer.connection.setLocalDescription(LocalRTCSessionDescription);\n          this.signalingServer.emit('peerOffer', peerId, LocalRTCSessionDescription);\n        })\n        .catch(() => {\n          this.dispatchEvent(new CustomEvent('connectionError', {\n            detail: { message: 'Failed to connect to another users' },\n          }));\n        });\n    });\n\n    Peer.channel.addEventListener('open', () => {\n      this.dispatchEvent(new CustomEvent('dataChannelStateChange', {\n        detail: { state: 'open', connection: { peerId } },\n      }));\n\n      Peer.channel.addEventListener('message', this.onMessage);\n    });\n\n    Peer.channel.addEventListener('close', () => {\n      this.dispatchEvent(new CustomEvent('dataChannelStateChange', {\n        detail: { state: 'close', connection: { peerId } },\n      }));\n    });\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  onPeerUpdate(peerId, data) {\n    // the peer might not exists yet becaouse 'peerUpdate' can occure before 'peerOffer'\n    if (!this.peers[peerId]) this.peers[peerId] = { ...this.newPeer };\n\n    const userData = JSON.parse(data);\n\n    this.peers[peerId].data = {\n      name: userData.name,\n      uri: userData.uri,\n    };\n\n    this.dispatchEvent(new CustomEvent('peerUpdate', {\n      detail: { peer: { id: peerId, name: userData.name, uri: userData.uri } },\n    }));\n  }\n\n  onMessage(MessageEvent) {\n    const { label, data } = JSON.parse(MessageEvent.data);\n\n    if (label === 'userdata') this.onPeerUserData(data);\n    if (label === 'message') {\n      this.dispatchEvent(new Event('message', { bubbles: false, cancelable: false }));\n    }\n  }\n\n  onPeerDisconnect(peerId) {\n    if (!this.peers[peerId]) return;\n\n    this.peers[peerId].channel.close();\n    this.peers[peerId].connection.close();\n    delete this.peers[peerId];\n  }\n\n  onSignalingServerMessage(label, data) {\n    //\n    console.log(label, data);\n\n    if (label === 'roomCreated') {\n      this.dispatchEvent(new CustomEvent('roomSuccess', {\n        detail: { action: 'created', room: { name: data } },\n      }));\n    }\n\n    if (label === 'roomJoined') {\n      this.dispatchEvent(new CustomEvent('roomSuccess', {\n        detail: { action: 'joined', room: { name: data } },\n      }));\n    }\n\n    if (label === 'roomError') {\n      this.dispatchEvent(new CustomEvent('roomError', {\n        detail: { message: data },\n      }));\n    }\n  }\n\n  createRoom() {\n    this.signalingServer.emit('createRoom');\n  }\n\n  joinRoom(roomName) {\n    this.signalingServer.emit('joinRoom', roomName);\n  }\n\n  signalReady(name, uri) {\n    this.signalingServer.emit('userReady', JSON.stringify({ name, uri }));\n  }\n}\n","export default (image, dSize = 100) =>\n  new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const img = new Image();\n    const canvas = document.createElement('canvas');\n    canvas.width = dSize;\n    canvas.height = dSize;\n    reader.addEventListener('load', () => {\n      img.addEventListener('load', () => {\n        if (img.width === img.height) {\n          canvas.getContext('2d').drawImage(img, 0, 0, dSize, dSize);\n        } else {\n          canvas\n            .getContext('2d')\n            .drawImage(\n              img,\n              img.width > img.height ? (img.width - img.height) / 2 : 0,\n              img.width > img.height ? 0 : (img.height - img.width) / 2,\n              img.width > img.height ? img.height : img.width,\n              img.width > img.height ? img.height : img.width,\n              0,\n              0,\n              dSize,\n              dSize,\n            );\n        }\n        resolve(canvas.toDataURL());\n      });\n      img.addEventListener('error', reject);\n      img.src = reader.result;\n    });\n    reader.addEventListener('error', reject);\n    reader.readAsDataURL(image);\n  });\n","\n// ja dat gaat te samen -> :) Maar uhm nu je heir toch bent, kunnen we t anders wel eens doorlopen\n\n\n// anders effe skype audio call?\n// totally fine\n\n// effe skype installeren :p\n// of via web zal ik doen\n\n// -> Francis De Clercq (skype)\n\n// ik kom he :p\n\n// -> Top (ik check ondertussen de files in de lib-map)\nimport DataChannel from './lib/DataChannel';\nimport thumbDataURI from './lib/thumbDataURI';\n\nlet datachannel = null;\n\nconst currentSection = 0;\n\nconst $buttonCreateRoom = document.querySelector('.button_create-room');\nconst $targetRoomName = document.querySelector('.target_room-name');\nconst $inputRoomName = document.querySelector('.input_room-name');\nconst $buttonJoinRoom = document.querySelector('.button_join-room');\n\nconst $inputUserName = document.querySelector('.input_user-name');\nconst $inputUserPicture = document.querySelector('.input_user-picture');\nconst $readyButton = document.querySelector('.button_ready');\n\nconst log = {\n  blue: (l, ...d) => console.log(`%c ${l} `, 'background:#1e90ff;color:#ff711e', ...d),\n  red: (l, ...d) => console.log(`%c ${l} `, 'background:#ff0000;color:#00ff00', ...d),\n  green: (l, ...d) => console.log(`%c ${l} `, 'background:yellowgreen;color:white', ...d),\n  orange: (l, ...d) => console.log(`%c ${l} `, 'background:orange;color:white', ...d),\n};\n\nconst onRoomError = (event) => {\n  log.orange('WARN', event.detail.message);\n};\n\nconst onRoomSuccess = (event) => {\n  const action = event.detail.action === 'created' ? 'created and joined' : 'joined';\n  const name = event.detail.room.name;\n\n  if (event.detail.action === 'created') {\n    $targetRoomName.textContent = name;\n\n    // start knop genereren en in pagina zetten\n  }\n\n  $inputRoomName.disabled = true;\n  $buttonCreateRoom.disabled = true;\n  $buttonJoinRoom.disabled = true;\n\n  log.blue('LOG', `Successfully ${action} the \"${name}\" room`);\n};\n\nconst onStateChange = (event) => {\n  const state = event.detail.state;\n  const peerId = event.detail.connection.peerId;\n\n  if (state === 'open') log.green('CONNECTION', `established with ${peerId}`);\n  if (state === 'close') log.red('DISCONNECTION', `from ${peerId}`);\n};\n\nconst onPeerUpdate = (event) => {\n  log.blue('LOG', `got update from peer ${event.detail.peer.id} name: ${event.detail.peer.name}`);\n};\n\nconst onReady = () => {\n  const name = $inputUserName.value;\n  const picture = $inputUserPicture.files[0];\n\n  if (!name || name === '' || !picture) return;\n\n  thumbDataURI(picture).then(uri => datachannel.signalReady(name, uri));\n};\n\nconst onJoinRoom = () => {\n  const roomName = $inputRoomName.value;\n  if (!roomName || roomName === '') return;\n  datachannel.joinRoom(roomName);\n};\n\nconst onKeyDown = (event) => {\n  if (event.keyCode !== 13) return;\n  onJoinRoom();\n};\n\nconst onGameStart = () => {\n  //\n  $scripts = Array.from(document.querySelectorAll('.deferredStyle'));\n  $scripts.forEach($script => {\n    const src = $script.dataset.src;\n    $script.src = src;\n  })\n};\n\nconst initDataChannel = () => {\n  datachannel = new DataChannel();\n\n  $buttonJoinRoom.addEventListener('click', onJoinRoom);\n  $inputRoomName.addEventListener('keydown', onKeyDown);\n  $buttonCreateRoom.addEventListener('click', datachannel.createRoom);\n  $readyButton.addEventListener('click', onReady);\n\n  datachannel.on('roomError', onRoomError);\n  datachannel.on('roomSuccess', onRoomSuccess);\n  datachannel.on('dataChannelStateChange', onStateChange);\n  datachannel.on('peerUpdate', onPeerUpdate);\n  datachannel.on('gameStart', onGameStart);\n};\n\nconst init = () => {\n  initDataChannel();\n\n  window.peers = datachannel.peers;\n  window.send = datachannel.sendMessage;\n};\n\ninit();\n"],"names":["EventTarget","listeners","addEventListener","type","callback","push","removeEventListener","stack","i","l","length","splice","dispatchEvent","event","call","defaultPrevented","on","DataChannel","peers","newPeer","RTCPeerConnectionOptions","iceServers","urls","RTCDataChannelOptions","ordered","maxPacketLifeTime","signalingServer","io","connect","bindClassMethods","setEventListeners","method","bind","onConnection","onPeerIce","onPeerAnswer","onPeerOffer","onPeerWantsACall","onPeerUpdate","onPeerDisconnect","onSignalingServerMessage","sendMessage","label","input","data","peerKeys","Object","keys","forEach","peerId","channel","readyState","message","JSON","stringify","send","log","id","RTCIceCandidate","candidate","connection","addIceCandidate","RemoteRTCSessionDescription","setRemoteDescription","Peer","RTCPeerConnection","then","createAnswer","LocalRTCSessionDescription","setLocalDescription","emit","catch","CustomEvent","RTCPeerConnectionIceEvent","RTCDataChannelEvent","state","onMessage","createDataChannel","createOffer","userData","parse","name","uri","peer","MessageEvent","onPeerUserData","Event","bubbles","cancelable","close","action","room","createRoom","joinRoom","roomName","signalReady","image","dSize","Promise","resolve","reject","reader","FileReader","img","Image","canvas","document","createElement","width","height","getContext","drawImage","toDataURL","src","result","readAsDataURL","datachannel","$buttonCreateRoom","querySelector","$targetRoomName","$inputRoomName","$buttonJoinRoom","$inputUserName","$inputUserPicture","$readyButton","d","onRoomError","orange","detail","onRoomSuccess","textContent","disabled","blue","onStateChange","green","red","onReady","value","picture","files","onJoinRoom","onKeyDown","keyCode","onGameStart","Array","from","querySelectorAll","$script","dataset","initDataChannel","init"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAqBA;yBACL;;;SACPC,SAAL,GAAiB,EAAjB;;;wBAGFC,6CAAiBC,MAAMC,UAAU;QAC3B,EAAED,QAAQ,KAAKF,SAAf,CAAJ,EAA+B;WACxBA,SAAL,CAAeE,IAAf,IAAuB,EAAvB;;SAEGF,SAAL,CAAeE,IAAf,EAAqBE,IAArB,CAA0BD,QAA1B;;;wBAGFE,mDAAoBH,MAAMC,UAAU;QAC9B,EAAED,QAAQ,KAAKF,SAAf,CAAJ,EAA+B;;QAEzBM,QAAQ,KAAKN,SAAL,CAAeE,IAAf,CAAd;SACK,IAAIK,IAAI,CAAR,EAAWC,IAAIF,MAAMG,MAA1B,EAAkCF,IAAIC,CAAtC,EAAyCD,KAAK,CAA9C,EAAiD;UAC3CD,MAAMC,CAAN,MAAaJ,QAAjB,EAA2B;cACnBO,MAAN,CAAaH,CAAb,EAAgB,CAAhB;;;;;;wBAMNI,uCAAcC,OAAO;QACf,EAAEA,MAAMV,IAAN,IAAc,KAAKF,SAArB,CAAJ,EAAqC,OAAO,IAAP;;QAE/BM,QAAQ,KAAKN,SAAL,CAAeY,MAAMV,IAArB,CAAd;SACK,IAAIK,IAAI,CAAR,EAAWC,IAAIF,MAAMG,MAA1B,EAAkCF,IAAIC,CAAtC,EAAyCD,KAAK,CAA9C,EAAiD;YACzCA,CAAN,EAASM,IAAT,CAAc,IAAd,EAAoBD,KAApB;;WAEK,CAACA,MAAME,gBAAd;;;wBAGFC,iBAAGb,MAAMC,UAAU;WACV,KAAKF,gBAAL,CAAsBC,IAAtB,EAA4BC,QAA5B,CAAP;;;;;;ICjCiBa;;;yBACL;;;gDACZ,uBADY;;UAGPC,KAAL,GAAa,EAAb;;UAEKC,OAAL,GAAe;kBACD,IADC;eAEJ,IAFI;YAGP;KAHR;;UAMKC,wBAAL,GAAgC,EAAEC,YAAY,CAAC,EAAEC,MAAM,CAAC,8BAAD,CAAR,EAAD,CAAd,EAAhC;UACKC,qBAAL,GAA6B,EAAEC,SAAS,KAAX,EAAkBC,mBAAmB,IAArC,EAA7B;;UAEKC,eAAL,GAAuBC,GAAGC,OAAH,CAAW,GAAX,CAAvB;;UAEKC,gBAAL;UACKC,iBAAL;;;;wBAGFD,+CAAmB;;SAEZ,IAAME,MAAX,IAAqB,IAArB,EAA2B;UACrB,OAAO,KAAKA,MAAL,CAAP,KAAwB,UAA5B,EAAwC;aACjCA,MAAL,IAAe,KAAKA,MAAL,EAAaC,IAAb,CAAkB,IAAlB,CAAf;;;;;wBAKNF,iDAAoB;SACbJ,eAAL,CAAqBV,EAArB,CAAwB,SAAxB,EAAmC,KAAKiB,YAAxC;SACKP,eAAL,CAAqBV,EAArB,CAAwB,SAAxB,EAAmC,KAAKkB,SAAxC;SACKR,eAAL,CAAqBV,EAArB,CAAwB,YAAxB,EAAsC,KAAKmB,YAA3C;SACKT,eAAL,CAAqBV,EAArB,CAAwB,WAAxB,EAAqC,KAAKoB,WAA1C;SACKV,eAAL,CAAqBV,EAArB,CAAwB,gBAAxB,EAA0C,KAAKqB,gBAA/C;SACKX,eAAL,CAAqBV,EAArB,CAAwB,YAAxB,EAAsC,KAAKsB,YAA3C;SACKZ,eAAL,CAAqBV,EAArB,CAAwB,gBAAxB,EAA0C,KAAKuB,gBAA/C;SACKb,eAAL,CAAqBV,EAArB,CAAwB,wBAAxB,EAAkD,KAAKwB,wBAAvD;;;wBAGFC,mCAAYC,OAAiB;;;sCAAPC,KAAO;WAAA;;;QACrBC,OAAOD,MAAMjC,MAAN,KAAiB,CAAjB,GAAqBiC,MAAM,CAAN,CAArB,GAAgCA,KAA7C;QACME,WAAWC,OAAOC,IAAP,CAAY,KAAK7B,KAAjB,CAAjB;;aAES8B,OAAT,CAAiB,UAACC,MAAD,EAAY;UACvB,CAAC,OAAK/B,KAAL,CAAW+B,MAAX,EAAmBC,OAAxB,EAAiC;UAC7B,OAAKhC,KAAL,CAAW+B,MAAX,EAAmBC,OAAnB,CAA2BC,UAA3B,KAA0C,MAA9C,EAAsD;;UAEhDC,UAAUC,KAAKC,SAAL,CAAe,EAAEZ,YAAF,EAASE,UAAT,EAAf,CAAhB;aACK1B,KAAL,CAAW+B,MAAX,EAAmBC,OAAnB,CAA2BK,IAA3B,CAAgCH,OAAhC;KALF;;;wBASFnB,uCAAe;YACLuB,GAAR,CAAY,KAAK9B,eAAL,CAAqB+B,EAAjC;;;wBAGFvB,+BAAUe,QAAQS,iBAAiB;QAC7B,CAACA,gBAAgBC,SAArB,EAAgC;QAC5B,CAAC,KAAKzC,KAAL,CAAW+B,MAAX,CAAL,EAAyB;;SAEpB/B,KAAL,CAAW+B,MAAX,EAAmBW,UAAnB,CAA8BC,eAA9B,CAA8CH,eAA9C;;;wBAGFvB,qCAAac,QAAQa,6BAA6B;QAC5C,CAAC,KAAK5C,KAAL,CAAW+B,MAAX,CAAL,EAAyB;;SAEpB/B,KAAL,CAAW+B,MAAX,EAAmBW,UAAnB,CAA8BG,oBAA9B,CAAmDD,2BAAnD;;;wBAGF1B,mCAAYa,QAAQa,6BAA6B;;;;QAE3C,CAAC,KAAK5C,KAAL,CAAW+B,MAAX,CAAL,EAAyB,KAAK/B,KAAL,CAAW+B,MAAX,iBAA0B,KAAK9B,OAA/B;;;;;;;QAOrB,KAAKD,KAAL,CAAW+B,MAAX,EAAmBW,UAAvB,EAAmC;;QAE7BI,OAAO,KAAK9C,KAAL,CAAW+B,MAAX,CAAb;;SAEKW,UAAL,GAAkB,IAAIK,iBAAJ,CAAsB,KAAK7C,wBAA3B,EAAqD,IAArD,CAAlB;;SAEKwC,UAAL,CACGG,oBADH,CACwBD,2BADxB,EAEGI,IAFH,CAEQ;aAAMF,KAAKJ,UAAL,CAAgBO,YAAhB,EAAN;KAFR,EAGGD,IAHH,CAGQ,UAACE,0BAAD,EAAgC;WAC/BR,UAAL,CAAgBS,mBAAhB,CAAoCD,0BAApC;aACK1C,eAAL,CAAqB4C,IAArB,CAA0B,YAA1B,EAAwCrB,MAAxC,EAAgDmB,0BAAhD;KALJ,EAOGG,KAPH,CAOS,YAAM;aACN3D,aAAL,CAAmB,IAAI4D,WAAJ,CAAgB,iBAAhB,EAAmC;gBAC5C,EAAEpB,SAAS,oCAAX;OADS,CAAnB;KARJ;;SAaKQ,UAAL,CAAgB1D,gBAAhB,CAAiC,cAAjC,EAAiD,UAACuE,yBAAD,EAA+B;UAC1E,CAACA,0BAA0Bd,SAA/B,EAA0C;;aAErCjC,eAAL,CAAqB4C,IAArB,CAA0B,SAA1B,EAAqCrB,MAArC,EAA6CwB,0BAA0Bd,SAAvE;KAHF;;SAMKC,UAAL,CAAgB1D,gBAAhB,CAAiC,aAAjC,EAAgD,UAACwE,mBAAD,EAAyB;UACnE,CAACA,oBAAoBxB,OAAzB,EAAkC;;WAE7BA,OAAL,GAAewB,oBAAoBxB,OAAnC;;WAEKA,OAAL,CAAahD,gBAAb,CAA8B,MAA9B,EAAsC,YAAM;eACrCU,aAAL,CAAmB,IAAI4D,WAAJ,CAAgB,wBAAhB,EAA0C;kBACnD,EAAEG,OAAO,MAAT,EAAiBf,YAAY,EAAEX,cAAF,EAA7B;SADS,CAAnB;;aAIKC,OAAL,CAAahD,gBAAb,CAA8B,SAA9B,EAAyC,OAAK0E,SAA9C;OALF;;WAQK1B,OAAL,CAAahD,gBAAb,CAA8B,OAA9B,EAAuC,YAAM;eACtCU,aAAL,CAAmB,IAAI4D,WAAJ,CAAgB,wBAAhB,EAA0C;kBACnD,EAAEG,OAAO,OAAT,EAAkBf,YAAY,EAAEX,cAAF,EAA9B;SADS,CAAnB;OADF;KAbF;;;wBAqBFZ,6CAAiBY,QAAQ;;;QACnB,KAAK/B,KAAL,CAAW+B,MAAX,CAAJ,EAAwB;;SAEnB/B,KAAL,CAAW+B,MAAX,iBAA0B,KAAK9B,OAA/B;QACM6C,OAAO,KAAK9C,KAAL,CAAW+B,MAAX,CAAb;;SAEKW,UAAL,GAAkB,IAAIK,iBAAJ,CAAsB,KAAK7C,wBAA3B,EAAqD,IAArD,CAAlB;;SAEK8B,OAAL,GAAec,KAAKJ,UAAL,CAAgBiB,iBAAhB,CAAkC,aAAlC,EAAiD,KAAKtD,qBAAtD,CAAf;;SAEKqC,UAAL,CAAgB1D,gBAAhB,CAAiC,aAAjC,EAAgD,UAACW,KAAD,EAAW;WACpDqC,OAAL,GAAerC,MAAMqC,OAArB;KADF;;SAIKU,UAAL,CAAgB1D,gBAAhB,CAAiC,cAAjC,EAAiD,UAACuE,yBAAD,EAA+B;UAC1E,CAACA,0BAA0Bd,SAA/B,EAA0C;;aAErCjC,eAAL,CAAqB4C,IAArB,CAA0B,SAA1B,EAAqCrB,MAArC,EAA6CwB,0BAA0Bd,SAAvE;KAHF;;SAMKC,UAAL,CAAgB1D,gBAAhB,CAAiC,mBAAjC,EAAsD,YAAM;WACrD0D,UAAL,CACGkB,WADH,GAEGZ,IAFH,CAEQ,UAACE,0BAAD,EAAgC;aAC/BR,UAAL,CAAgBS,mBAAhB,CAAoCD,0BAApC;eACK1C,eAAL,CAAqB4C,IAArB,CAA0B,WAA1B,EAAuCrB,MAAvC,EAA+CmB,0BAA/C;OAJJ,EAMGG,KANH,CAMS,YAAM;eACN3D,aAAL,CAAmB,IAAI4D,WAAJ,CAAgB,iBAAhB,EAAmC;kBAC5C,EAAEpB,SAAS,oCAAX;SADS,CAAnB;OAPJ;KADF;;SAcKF,OAAL,CAAahD,gBAAb,CAA8B,MAA9B,EAAsC,YAAM;aACrCU,aAAL,CAAmB,IAAI4D,WAAJ,CAAgB,wBAAhB,EAA0C;gBACnD,EAAEG,OAAO,MAAT,EAAiBf,YAAY,EAAEX,cAAF,EAA7B;OADS,CAAnB;;WAIKC,OAAL,CAAahD,gBAAb,CAA8B,SAA9B,EAAyC,OAAK0E,SAA9C;KALF;;SAQK1B,OAAL,CAAahD,gBAAb,CAA8B,OAA9B,EAAuC,YAAM;aACtCU,aAAL,CAAmB,IAAI4D,WAAJ,CAAgB,wBAAhB,EAA0C;gBACnD,EAAEG,OAAO,OAAT,EAAkBf,YAAY,EAAEX,cAAF,EAA9B;OADS,CAAnB;KADF;;;;;;wBAQFX,qCAAaW,QAAQL,MAAM;;QAErB,CAAC,KAAK1B,KAAL,CAAW+B,MAAX,CAAL,EAAyB,KAAK/B,KAAL,CAAW+B,MAAX,iBAA0B,KAAK9B,OAA/B;;QAEnB4D,WAAW1B,KAAK2B,KAAL,CAAWpC,IAAX,CAAjB;;SAEK1B,KAAL,CAAW+B,MAAX,EAAmBL,IAAnB,GAA0B;YAClBmC,SAASE,IADS;WAEnBF,SAASG;KAFhB;;SAKKtE,aAAL,CAAmB,IAAI4D,WAAJ,CAAgB,YAAhB,EAA8B;cACvC,EAAEW,MAAM,EAAE1B,IAAIR,MAAN,EAAcgC,MAAMF,SAASE,IAA7B,EAAmCC,KAAKH,SAASG,GAAjD,EAAR;KADS,CAAnB;;;wBAKFN,+BAAUQ,cAAc;sBACE/B,KAAK2B,KAAL,CAAWI,aAAaxC,IAAxB,CADF;QACdF,KADc,eACdA,KADc;QACPE,IADO,eACPA,IADO;;QAGlBF,UAAU,UAAd,EAA0B,KAAK2C,cAAL,CAAoBzC,IAApB;QACtBF,UAAU,SAAd,EAAyB;WAClB9B,aAAL,CAAmB,IAAI0E,KAAJ,CAAU,SAAV,EAAqB,EAAEC,SAAS,KAAX,EAAkBC,YAAY,KAA9B,EAArB,CAAnB;;;;wBAIJjD,6CAAiBU,QAAQ;QACnB,CAAC,KAAK/B,KAAL,CAAW+B,MAAX,CAAL,EAAyB;;SAEpB/B,KAAL,CAAW+B,MAAX,EAAmBC,OAAnB,CAA2BuC,KAA3B;SACKvE,KAAL,CAAW+B,MAAX,EAAmBW,UAAnB,CAA8B6B,KAA9B;WACO,KAAKvE,KAAL,CAAW+B,MAAX,CAAP;;;wBAGFT,6DAAyBE,OAAOE,MAAM;;YAE5BY,GAAR,CAAYd,KAAZ,EAAmBE,IAAnB;;QAEIF,UAAU,aAAd,EAA6B;WACtB9B,aAAL,CAAmB,IAAI4D,WAAJ,CAAgB,aAAhB,EAA+B;gBACxC,EAAEkB,QAAQ,SAAV,EAAqBC,MAAM,EAAEV,MAAMrC,IAAR,EAA3B;OADS,CAAnB;;;QAKEF,UAAU,YAAd,EAA4B;WACrB9B,aAAL,CAAmB,IAAI4D,WAAJ,CAAgB,aAAhB,EAA+B;gBACxC,EAAEkB,QAAQ,QAAV,EAAoBC,MAAM,EAAEV,MAAMrC,IAAR,EAA1B;OADS,CAAnB;;;QAKEF,UAAU,WAAd,EAA2B;WACpB9B,aAAL,CAAmB,IAAI4D,WAAJ,CAAgB,WAAhB,EAA6B;gBACtC,EAAEpB,SAASR,IAAX;OADS,CAAnB;;;;wBAMJgD,mCAAa;SACNlE,eAAL,CAAqB4C,IAArB,CAA0B,YAA1B;;;wBAGFuB,6BAASC,UAAU;SACZpE,eAAL,CAAqB4C,IAArB,CAA0B,UAA1B,EAAsCwB,QAAtC;;;wBAGFC,mCAAYd,MAAMC,KAAK;SAChBxD,eAAL,CAAqB4C,IAArB,CAA0B,WAA1B,EAAuCjB,KAAKC,SAAL,CAAe,EAAE2B,UAAF,EAAQC,QAAR,EAAf,CAAvC;;;;EAjPqClF;;ACFzC,oBAAe,UAACgG,KAAD;MAAQC,KAAR,uEAAgB,GAAhB;SACb,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;QACzBC,SAAS,IAAIC,UAAJ,EAAf;QACMC,MAAM,IAAIC,KAAJ,EAAZ;QACMC,SAASC,SAASC,aAAT,CAAuB,QAAvB,CAAf;WACOC,KAAP,GAAeX,KAAf;WACOY,MAAP,GAAgBZ,KAAhB;WACO/F,gBAAP,CAAwB,MAAxB,EAAgC,YAAM;UAChCA,gBAAJ,CAAqB,MAArB,EAA6B,YAAM;YAC7BqG,IAAIK,KAAJ,KAAcL,IAAIM,MAAtB,EAA8B;iBACrBC,UAAP,CAAkB,IAAlB,EAAwBC,SAAxB,CAAkCR,GAAlC,EAAuC,CAAvC,EAA0C,CAA1C,EAA6CN,KAA7C,EAAoDA,KAApD;SADF,MAEO;iBAEFa,UADH,CACc,IADd,EAEGC,SAFH,CAGIR,GAHJ,EAIIA,IAAIK,KAAJ,GAAYL,IAAIM,MAAhB,GAAyB,CAACN,IAAIK,KAAJ,GAAYL,IAAIM,MAAjB,IAA2B,CAApD,GAAwD,CAJ5D,EAKIN,IAAIK,KAAJ,GAAYL,IAAIM,MAAhB,GAAyB,CAAzB,GAA6B,CAACN,IAAIM,MAAJ,GAAaN,IAAIK,KAAlB,IAA2B,CAL5D,EAMIL,IAAIK,KAAJ,GAAYL,IAAIM,MAAhB,GAAyBN,IAAIM,MAA7B,GAAsCN,IAAIK,KAN9C,EAOIL,IAAIK,KAAJ,GAAYL,IAAIM,MAAhB,GAAyBN,IAAIM,MAA7B,GAAsCN,IAAIK,KAP9C,EAQI,CARJ,EASI,CATJ,EAUIX,KAVJ,EAWIA,KAXJ;;gBAcMQ,OAAOO,SAAP,EAAR;OAlBF;UAoBI9G,gBAAJ,CAAqB,OAArB,EAA8BkG,MAA9B;UACIa,GAAJ,GAAUZ,OAAOa,MAAjB;KAtBF;WAwBOhH,gBAAP,CAAwB,OAAxB,EAAiCkG,MAAjC;WACOe,aAAP,CAAqBnB,KAArB;GA/BF,CADa;CAAf;;ACCA;;;;;;;;;;;;;;AAcA,AAGA,IAAIoB,cAAc,IAAlB;;AAEA,AAEA,IAAMC,oBAAoBX,SAASY,aAAT,CAAuB,qBAAvB,CAA1B;AACA,IAAMC,kBAAkBb,SAASY,aAAT,CAAuB,mBAAvB,CAAxB;AACA,IAAME,iBAAiBd,SAASY,aAAT,CAAuB,kBAAvB,CAAvB;AACA,IAAMG,kBAAkBf,SAASY,aAAT,CAAuB,mBAAvB,CAAxB;;AAEA,IAAMI,iBAAiBhB,SAASY,aAAT,CAAuB,kBAAvB,CAAvB;AACA,IAAMK,oBAAoBjB,SAASY,aAAT,CAAuB,qBAAvB,CAA1B;AACA,IAAMM,eAAelB,SAASY,aAAT,CAAuB,eAAvB,CAArB;;AAEA,IAAM9D,MAAM;QACJ,cAAC/C,CAAD;;;sCAAOoH,CAAP;OAAA;;;WAAa,qBAAQrE,GAAR,0BAAkB/C,CAAlB,QAAwB,kCAAxB,SAA+DoH,CAA/D,EAAb;GADI;OAEL,aAACpH,CAAD;;;uCAAOoH,CAAP;OAAA;;;WAAa,sBAAQrE,GAAR,2BAAkB/C,CAAlB,QAAwB,kCAAxB,SAA+DoH,CAA/D,EAAb;GAFK;SAGH,eAACpH,CAAD;;;uCAAOoH,CAAP;OAAA;;;WAAa,sBAAQrE,GAAR,2BAAkB/C,CAAlB,QAAwB,oCAAxB,SAAiEoH,CAAjE,EAAb;GAHG;UAIF,gBAACpH,CAAD;;;uCAAOoH,CAAP;OAAA;;;WAAa,sBAAQrE,GAAR,2BAAkB/C,CAAlB,QAAwB,+BAAxB,SAA4DoH,CAA5D,EAAb;;CAJV;;AAOA,IAAMC,cAAc,SAAdA,WAAc,CAACjH,KAAD,EAAW;MACzBkH,MAAJ,CAAW,MAAX,EAAmBlH,MAAMmH,MAAN,CAAa5E,OAAhC;CADF;;AAIA,IAAM6E,gBAAgB,SAAhBA,aAAgB,CAACpH,KAAD,EAAW;MACzB6E,SAAS7E,MAAMmH,MAAN,CAAatC,MAAb,KAAwB,SAAxB,GAAoC,oBAApC,GAA2D,QAA1E;MACMT,OAAOpE,MAAMmH,MAAN,CAAarC,IAAb,CAAkBV,IAA/B;;MAEIpE,MAAMmH,MAAN,CAAatC,MAAb,KAAwB,SAA5B,EAAuC;oBACrBwC,WAAhB,GAA8BjD,IAA9B;;;;;iBAKakD,QAAf,GAA0B,IAA1B;oBACkBA,QAAlB,GAA6B,IAA7B;kBACgBA,QAAhB,GAA2B,IAA3B;;MAEIC,IAAJ,CAAS,KAAT,oBAAgC1C,MAAhC,cAA+CT,IAA/C;CAdF;;AAiBA,IAAMoD,gBAAgB,SAAhBA,aAAgB,CAACxH,KAAD,EAAW;MACzB8D,QAAQ9D,MAAMmH,MAAN,CAAarD,KAA3B;MACM1B,SAASpC,MAAMmH,MAAN,CAAapE,UAAb,CAAwBX,MAAvC;;MAEI0B,UAAU,MAAd,EAAsBnB,IAAI8E,KAAJ,CAAU,YAAV,wBAA4CrF,MAA5C;MAClB0B,UAAU,OAAd,EAAuBnB,IAAI+E,GAAJ,CAAQ,eAAR,YAAiCtF,MAAjC;CALzB;;AAQA,IAAMX,eAAe,SAAfA,YAAe,CAACzB,KAAD,EAAW;MAC1BuH,IAAJ,CAAS,KAAT,4BAAwCvH,MAAMmH,MAAN,CAAa7C,IAAb,CAAkB1B,EAA1D,eAAsE5C,MAAMmH,MAAN,CAAa7C,IAAb,CAAkBF,IAAxF;CADF;;AAIA,IAAMuD,UAAU,SAAVA,OAAU,GAAM;MACdvD,OAAOyC,eAAee,KAA5B;MACMC,UAAUf,kBAAkBgB,KAAlB,CAAwB,CAAxB,CAAhB;;MAEI,CAAC1D,IAAD,IAASA,SAAS,EAAlB,IAAwB,CAACyD,OAA7B,EAAsC;;eAEzBA,OAAb,EAAsBxE,IAAtB,CAA2B;WAAOkD,YAAYrB,WAAZ,CAAwBd,IAAxB,EAA8BC,GAA9B,CAAP;GAA3B;CANF;;AASA,IAAM0D,aAAa,SAAbA,UAAa,GAAM;MACjB9C,WAAW0B,eAAeiB,KAAhC;MACI,CAAC3C,QAAD,IAAaA,aAAa,EAA9B,EAAkC;cACtBD,QAAZ,CAAqBC,QAArB;CAHF;;AAMA,IAAM+C,YAAY,SAAZA,SAAY,CAAChI,KAAD,EAAW;MACvBA,MAAMiI,OAAN,KAAkB,EAAtB,EAA0B;;CAD5B;;AAKA,IAAMC,cAAc,SAAdA,WAAc,GAAM;;aAEbC,MAAMC,IAAN,CAAWvC,SAASwC,gBAAT,CAA0B,gBAA1B,CAAX,CAAX;WACSlG,OAAT,CAAiB,mBAAW;QACpBiE,MAAMkC,QAAQC,OAAR,CAAgBnC,GAA5B;YACQA,GAAR,GAAcA,GAAd;GAFF;CAHF;;AASA,IAAMoC,kBAAkB,SAAlBA,eAAkB,GAAM;gBACd,IAAIpI,WAAJ,EAAd;;kBAEgBf,gBAAhB,CAAiC,OAAjC,EAA0C0I,UAA1C;iBACe1I,gBAAf,CAAgC,SAAhC,EAA2C2I,SAA3C;oBACkB3I,gBAAlB,CAAmC,OAAnC,EAA4CkH,YAAYxB,UAAxD;eACa1F,gBAAb,CAA8B,OAA9B,EAAuCsI,OAAvC;;cAEYxH,EAAZ,CAAe,WAAf,EAA4B8G,WAA5B;cACY9G,EAAZ,CAAe,aAAf,EAA8BiH,aAA9B;cACYjH,EAAZ,CAAe,wBAAf,EAAyCqH,aAAzC;cACYrH,EAAZ,CAAe,YAAf,EAA6BsB,YAA7B;cACYtB,EAAZ,CAAe,WAAf,EAA4B+H,WAA5B;CAZF;;AAeA,IAAMO,OAAO,SAAPA,IAAO,GAAM;;;SAGVpI,KAAP,GAAekG,YAAYlG,KAA3B;SACOqC,IAAP,GAAc6D,YAAY3E,WAA1B;CAJF;;AAOA6G;;;;"}